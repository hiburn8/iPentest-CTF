//
//  SettingsViewController.m
//  iPentestCTF
//
//  Created by Daniel on 08/04/2015.
//  Copyright (c) 2015 Daniel Reece. All rights reserved.
//

#import "SettingsViewController.h"

@implementation SettingsViewController


- (void)viewDidLoad {
    [super viewDidLoad];
    // Do view setup here.
    
    NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
    if([defaults objectForKey:@"locations"]){
        
        _locationField.text = [defaults objectForKey:@"locations"];
        
    }
    if([defaults objectForKey:@"username"]){
        
        _usernameField.text = [defaults objectForKey:@"username"];
        
    }
}
- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event{
    [self.view endEditing:YES];
    [super touchesBegan:touches withEvent:event];
}


- (IBAction)settingsButton:(id)sender {
    NSString *location = _locationField.text;
    NSString *username = _usernameField.text;
    
    
    NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
    if (![_locationField.text  isEqual: @"peach.net"]){
        NSString *apiURL = [[NSString alloc] initWithFormat:@"%@/api.php", location];
        
        
        NSMutableURLRequest *request = [[NSMutableURLRequest alloc]
                                        initWithURL:[NSURL URLWithString:apiURL]];
        [request setHTTPMethod:@"GET"];
        
        
        //  [[NSURLConnection alloc] initWithRequest:request delegate:self];
        
        NSHTTPURLResponse *response = nil;
        NSError *error = nil;
        NSData *respData = [NSURLConnection sendSynchronousRequest:request returningResponse:&response error:&error];
        NSString *notification = [[NSString alloc] initWithData:respData encoding:NSUTF8StringEncoding];
        
        NSLog(notification);
        NSString * ready = @"ready";
        if ([ready isEqualToString:notification]){
            [defaults setObject:_locationField.text forKey:@"location"];
            [[NSUserDefaults standardUserDefaults] synchronize];
            _locationStatus.text = @"ok - saved";
            
           // [self checkusername:_usernameField.text];
            
            
            
        //}
        //else{
        //    _locationStatus.text = @"bad";
        //}
    }
}
}
@end
    
/*
- (void)checkusername:(NSString *)nametry {
        
    NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
    NSString * locaton = [defaults objectForKey:@"locations"];
    
    
    if (![_usernameField.text  isEqual: @"crashOverride"]){
        
        NSString *apiURL = [[NSString alloc] initWithFormat:@"%@/api.php?user=%@", locaton, nametry];
        
        NSMutableURLRequest *request = [[NSMutableURLRequest alloc]
                                        initWithURL:[NSURL URLWithString:apiURL]];
        [request setHTTPMethod:@"GET"];
        NSHTTPURLResponse *response = nil;
        NSError *error = nil;
        NSData *respData = [NSURLConnection sendSynchronousRequest:request returningResponse:&response error:&error];
        NSString *notification = [[NSString alloc] initWithData:respData encoding:NSUTF8StringEncoding];
        if ([notification isEqual:@"ok"]){
            [defaults setObject:_locationField.text forKey:@"username"];
            [[NSUserDefaults standardUserDefaults] synchronize];
            _usernameStatus.text = @"ok - saved";
        }
        else{
            _usernameStatus.text = @"bad";
        }
    }
}


@end*/
